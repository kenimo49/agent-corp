# プロダクト運用ロードマップ

agent-corpを使って実際にプロダクトを開発・運用する際のフェーズ定義。

> **フレームワーク開発ロードマップ**（agent-corp自体の開発計画）は [ROADMAP.md](./ROADMAP.md) を参照。

---

## このドキュメントの位置づけ

```
ROADMAP.md      = agent-corpフレームワーク自体をどう作るか
ROADMAP-OPS.md  = agent-corpを使ってプロダクトをどう運用するか（本ドキュメント）
```

各Phaseには**前提条件**として、フレームワーク側のバージョン要件を記載している。
フレームワークの開発とプロダクト運用は並行して進められるが、Phase移行には対応するフレームワーク機能が必要。

```
ROADMAP.md（フレームワーク開発）          ROADMAP-OPS.md（プロダクト運用）
─────────────────────────────          ────────────────────────────
v1.0 ✅ 基本構造
v1.1 エージェント実行基盤修正  ───────▶  Phase 1: 開発チーム検証
v1.2 Tool・MCP基盤           ───────▶  Phase 2: デプロイ自動化
v1.3 チーム動的構成           ───────▶  Phase 3: 運用チーム稼働
v1.5 開発チーム拡張           ───────▶  Phase 3: レビュー・QA込みフロー
v2.0 フルライフサイクル        ───────▶  Phase 4: 全チーム統合運用
v2.5 継続的開発サイクル        ───────▶  Phase 5: 自律改善ループ
```

---

## Phase 1: 開発チーム検証

**目的**: エージェントが実際にコードを書いて動くものを作れるか確認する。

**前提**: ROADMAP.md v1.1（エージェント実行基盤修正）が完了していること。

### チーム構成

```
人間（あなた）
  └── 仕様・方針を決める
        │
        ▼
      PM（既存）
        └── タスク分解
              │
     ┌────────┼────────┐
     ▼        ▼        ▼
  Frontend  Backend  Security
  Engineer  Engineer Engineer
     │        │        │
     └────────┼────────┘
              ▼
         成果物確認（人間）
```

### やること

- [ ] 小規模なアプリ（例: TODOアプリ、1ページのWebアプリ等）を題材にする
- [ ] 人間が仕様をmarkdownで `shared/requirements/` に配置
- [ ] PM → Engineer の流れでコードが生成されることを確認
- [ ] 生成されたコードが**実際にビルド・実行できるか**を人間が確認
- [ ] エージェント間の情報伝達で仕様の欠落が起きないかを確認

### 確認ポイント

| 項目 | 確認方法 |
|------|----------|
| コード品質 | 生成コードのビルド成功率 |
| 仕様忠実度 | 要件とアウトプットの一致度 |
| エージェント間連携 | PM→Engineerの指示に情報欠落がないか |
| エラーリカバリ | ビルドエラー時にエージェントが自己修正できるか |

### Phase 1 完了基準

- [ ] 指定した仕様通りのアプリが生成され、ローカルで動作する
- [ ] エージェントがビルドエラーを自己修正できる
- [ ] 人間の介入は「仕様投入」と「最終確認」のみ

---

## Phase 2: デプロイ自動化

**目的**: 開発したアプリをエージェントがデプロイまで完了できるようにする。

**前提**: ROADMAP.md v1.2（Tool・MCP基盤）が完了していること。

### チーム構成（Phase 1 + インフラ担当）

```
人間
  └── 仕様 + デプロイ先の指定
        │
        ▼
      PM → Engineers（Phase 1と同じ）
              │
              ▼ 実装完了
        インフラ担当
          ├── CI/CDパイプライン構築
          ├── デプロイ実行
          └── 動作確認
              │
              ▼
        デプロイ完了報告（人間に確認依頼）
```

### やること

- [ ] インフラ担当エージェントのプロンプト作成
- [ ] デプロイ先の設定（Vercel / Cloudflare Pages / AWS 等）
- [ ] MCP Server経由でのデプロイコマンド実行
- [ ] デプロイ後のヘルスチェック自動化
- [ ] **人間の承認ゲート**: デプロイ前に人間に確認を求める仕組み

### 確認ポイント

| 項目 | 確認方法 |
|------|----------|
| デプロイ成功率 | 自動デプロイの成功/失敗率 |
| 環境設定の正確性 | 環境変数、シークレットの扱い |
| ロールバック | デプロイ失敗時の自動ロールバック |

### Phase 2 完了基準

- [ ] エージェントが実装からデプロイまで一気通貫で実行できる
- [ ] デプロイ前の承認ゲートが機能する
- [ ] デプロイ後のヘルスチェックが自動で走る

---

## Phase 3: 運用・品質管理

**目的**: リリース後の運用体制と、開発フローの品質管理（レビュー・QA）を確立する。

**前提**: ROADMAP.md v1.3（チーム動的構成）+ v1.5（開発チーム拡張）が完了していること。

### チーム構成

```
人間
  └── 方針・優先度の決定
        │
  ┌─────┴─────────────────────┐
  ▼                           ▼
開発チーム                   運用チーム
  PDM                        運用リーダー
    └── Developer(s)           ├── インフラ担当
          └── Reviewer           │   ├── 稼働監視
                └── QA           │   ├── コスト確認
                     │           │   └── セキュリティ
                     ▼           └── TS（テクニカルサポート）
                リリース ──▶ 運用チームが監視開始
```

### やること

#### 開発品質

- [ ] Reviewerロールのプロンプト作成・検証
- [ ] QAロールのプロンプト作成・検証（テスト設計・実行）
- [ ] Developer → Reviewer → QA → リリースのフロー確立
- [ ] レビュー指摘でDeveloperが修正→再レビューのループ確認

#### 運用体制

- [ ] 運用リーダーのプロンプト作成
- [ ] インフラ担当のプロンプト作成
- [ ] 監視APIとの連携（Datadog / CloudWatch / Uptime監視等）
- [ ] 障害検知 → `shared/incidents/` に起票 → 対応フロー
- [ ] 障害の GitHub Issue 自動登録

### 確認ポイント

| 項目 | 確認方法 |
|------|----------|
| レビュー品質 | Reviewerが実際のバグを検出できるか |
| QA網羅性 | QAのテスト設計がエッジケースをカバーするか |
| 障害検知速度 | アラートから起票までの所要時間 |
| 障害対応 | インシデントフローが正しく流れるか |

### Phase 3 完了基準

- [ ] 開発→レビュー→QA→リリースのフローが人間介入なしで回る
- [ ] 意図的に障害を起こし、検知→起票→対応報告まで自動で流れる
- [ ] 日次の稼働レポートが生成される

---

## Phase 4: 全チーム統合運用

**目的**: COO・広報を含む全チームを稼働させ、プロダクトのフルライフサイクルをエージェントが運用する。

**前提**: ROADMAP.md v2.0（フルライフサイクル）が完了していること。

### チーム構成（フル体制）

```
人間
  └── 方針だけ伝える
        │
        ▼
      COO（全体統括）
        ├── 日次レポート作成
        ├── チーム間の課題調整
        └── 人間への最終報告
              │
  ┌───────────┼───────────────┐
  ▼           ▼               ▼
広報チーム   開発チーム       運用チーム
  │          (Phase 3)       (Phase 3)
  ├── X投稿
  ├── Reddit投稿
  └── リリース報告
```

### やること

- [ ] COOロールのプロンプト作成・検証
- [ ] 広報チームのプロンプト作成
- [ ] X API / Reddit API の MCP Server構築
- [ ] リリース → 広報投稿の自動フロー
- [ ] **投稿承認ゲート**: 自動投稿 or 人間承認の切り替え
- [ ] COO日次レポートの生成・通知
- [ ] 全チーム統合テスト（E2E: 要件投入 → 実装 → デプロイ → 広報 → 運用）

### 確認ポイント

| 項目 | 確認方法 |
|------|----------|
| 投稿品質 | 広報の投稿文が適切か（トーン、正確性） |
| 統括品質 | COOレポートが実態を正確に反映しているか |
| E2E完走 | 要件投入から広報投稿まで全自動で完走するか |
| 承認ゲート | 人間承認が必要な箇所で正しく停止するか |

### Phase 4 完了基準

- [ ] 「Xというアプリを作って運用して広告して」で全フローが動く
- [ ] 人間の介入は「方針決定」「承認ゲートでの判断」「最終確認」のみ
- [ ] 障害発生時に運用チームが自動対応し、COOが人間に報告する

---

## Phase 5: 継続的追加開発サイクル

**目的**: 初回リリース後、プロダクトを継続的に改善・拡張するサイクルをエージェント主導で回す。

**前提**: Phase 4が完了し、全チームが稼働していること。

### Phase 4までとの違い

Phase 1-4は「ゼロから作って初回リリース」。Phase 5は**既存プロダクトがある状態**で回る。

| 観点 | Phase 1-4（初回） | Phase 5（継続） |
|------|-------------------|----------------|
| コードベース | なし→新規作成 | 既存コードあり（壊さない） |
| 本番環境 | なし→構築 | 稼働中（ダウンタイム不可） |
| ユーザー | いない | いる（破壊的変更の考慮） |
| 要件の出どころ | 人間のみ | 人間 + エージェント自律発見 |

### 要件のトリガー

Phase 5では、人間の指示以外にもエージェントが自律的に要件を発見する。

```
shared/requirements/ への投入元:

  [人間]
    └── 新機能要件、方針変更

  [運用チーム]
    ├── 障害のポストモーテムから改善要件を起票
    └── インフラ担当: パフォーマンス劣化の改善提案

  [TS]
    └── ユーザーフィードバック集約 → 機能要望として起票

  [COO]
    ├── メトリクス分析から改善提案
    └── 競合動向に基づく機能提案（将来）

  [セキュリティ担当]
    └── 脆弱性検出 → 修正要件として起票
```

### 開発3レーン

すべての要件を同じフローで処理すると、緊急の修正が通常開発に埋もれる。3つのレーンで並行処理する。

```
要件収集
  │
  ▼
トリアージ（COO or PDM）
  │ 緊急度 x 影響度で分類
  │
  ├─── [緊急] ──────▶ Hotfixレーン
  │                     │ 最小限の修正
  │                     │ Reviewer確認のみ（QAは事後）
  │                     │ 即デプロイ
  │                     ▼
  │                   本番反映 → 事後QA → 事後レポート
  │
  ├─── [通常] ──────▶ 通常開発レーン
  │                     │ フルフロー
  │                     │ PDM → Developer → Reviewer → QA
  │                     │ ステージング検証 → デプロイ
  │                     ▼
  │                   本番反映 → 広報（リリースノート）
  │
  └─── [実験] ──────▶ 実験レーン
                        │ フィーチャーフラグで隔離
                        │ 一部ユーザーにのみ公開
                        │ メトリクス計測
                        ▼
                      結果判定 → 全体公開 or 撤退
```

### フィードバックループ

リリースして終わりではなく、結果を計測して次の要件につなげる。

```
デプロイ完了
  │
  ▼
運用チーム: メトリクス計測（エラー率、レスポンスタイム、利用率）
  │
  ▼
COO: 結果レポート作成
  ├── 成功 → 次の要件サイクルへ
  ├── 問題あり → 改善要件として再投入
  └── 実験失敗 → ロールバック + 知見記録
  │
  ▼
shared/requirements/ に次のサイクルの要件が蓄積
  │
  └── ループ先頭に戻る
```

### やること

- [ ] トリアージの仕組み（緊急/通常/実験の分類ロジック）
- [ ] Hotfixレーン: 簡略化フロー（Reviewer確認のみ→即デプロイ）
- [ ] 通常開発レーン: Phase 3-4のフルフローをそのまま活用
- [ ] 実験レーン: フィーチャーフラグ管理の仕組み
- [ ] 自律要件発見: 各チームが `shared/requirements/` に自動起票する仕組み
- [ ] フィードバックループ: デプロイ後メトリクス → 次の要件への変換
- [ ] サイクル履歴の記録（何を作り、何が成功/失敗したか）

### 確認ポイント

| 項目 | 確認方法 |
|------|----------|
| トリアージ精度 | 緊急/通常/実験の分類が妥当か |
| Hotfix速度 | 障害検知からHotfixデプロイまでの所要時間 |
| 既存機能への影響 | 追加開発後にリグレッションが発生しないか |
| フィードバック品質 | メトリクス計測→要件への変換が的確か |
| 自律要件の質 | エージェントが起票した要件が実際に価値あるか |

### Phase 5 完了基準

- [ ] 人間が要件を投入しなくても、エージェントが自律的に改善サイクルを回せる
- [ ] Hotfix/通常/実験の3レーンが並行して動作する
- [ ] デプロイ→計測→次の要件のフィードバックループが自動で回る
- [ ] 1サイクル（要件→デプロイ→計測）の結果が記録され、蓄積される

---

## 承認ゲート設計

全Phaseを通じて、エージェントの自動実行範囲を明確にする。

| アクション | Phase 1 | Phase 2 | Phase 3 | Phase 4 | Phase 5 |
|-----------|---------|---------|---------|---------|---------|
| コード生成 | 自動 | 自動 | 自動 | 自動 | 自動 |
| コードレビュー | - | - | 自動 | 自動 | 自動 |
| テスト実行 | 手動 | 自動 | 自動 | 自動 | 自動 |
| デプロイ（通常） | - | **承認必要** | **承認必要** | 設定次第 | 設定次第 |
| デプロイ（Hotfix） | - | - | - | - | **承認必要** |
| SNS投稿 | - | - | - | **承認必要** | 設定次第 |
| 障害対応 | - | - | 自動 | 自動 | 自動 |
| issue作成 | - | - | 自動 | 自動 | 自動 |
| 自律要件起票 | - | - | - | - | 自動（人間通知） |
| フィーチャーフラグ操作 | - | - | - | - | 自動 |
| 課金変更 | - | - | **禁止** | **禁止** | **禁止** |

---

## 運用コスト見積もりの観点

各Phaseでの主なコスト要因を意識しておく。

| コスト項目 | 説明 |
|-----------|------|
| LLM API利用料 | エージェント数 x ポーリング頻度 x トークン消費量 |
| 外部API利用料 | X API, 監視サービス, クラウドインフラ等 |
| インフラ費用 | デプロイ先のホスティング費用 |

Phase 1の検証時に、1タスクあたりのトークン消費量と所要時間を計測し、フル運用時のコストを見積もることを推奨。
